'use client'

import { useState } from 'react'

import { useForm, SubmitHandler } from 'react-hook-form'

import { useDispatch, useSelector } from 'react-redux'
import { setEmployeeData } from '@/lib/slices/employeeSlice'
import { RootState } from '@/lib/store'

import { EmployeeFormData } from '@/lib/types'
import {
  steps,
  genders,
  visaCategories,
  countries,
  jobTitles,
  departments,
  employmentStatuses,
  payFrequency,
  paymentMethods,
  taxCodes
} from '@/constants/constants'
import DatePickerCont from './DatePickerCont'

const EmployeeOnboardingForm = () => {
  const employeeData = useSelector((state: RootState) => state.employee.data)
  const dispatch = useDispatch()
  const [ currentStep, setCurrentStep ] = useState(0)

  const parsedData = employeeData ? JSON.parse(employeeData) : null

  const processForm: SubmitHandler<EmployeeFormData> = data => {
    console.log(data)
    const stringData = JSON.stringify(data)
    console.log(stringData)
    dispatch(setEmployeeData(stringData))
    setCurrentStep(steps.length - 1)
    reset()
  }

  const {
    register,
    handleSubmit,
    reset,
    trigger,
    control,
    formState: { errors }
  } = useForm<EmployeeFormData>({
    defaultValues: {
      country: '',
      gender: '',
      visaCategory: '',
      jobTitle: '',
      department: '',
      employmentStatus: '',
      payFrequency: '',
      paymentMethod: '',
      taxCode: ''
    }
  })

  type FieldName = keyof EmployeeFormData

  // NAVIGATION FUNCTIONS

  const next = async () => {
    const fields = steps[currentStep].fields
    const output = await trigger(fields as FieldName[], { shouldFocus: true })

    if (!output) return

    if (currentStep < steps.length - 1) {
      if (currentStep === steps.length - 2) {
        await handleSubmit(processForm)
      }
      setCurrentStep(step => step + 1)
    }
  }

  const prev = () => {
    if (currentStep > 0) {
      setCurrentStep(step => step - 1)
    }
  }

  return (
    <section className='inset-0 flex flex-col justify-between p-24'>
      {/* Navigation Steps */}
      <nav aria-label='Progress' className='sticky top-24 z-10 bg-white sm:p-5 md:py-10'>
        <ol
          role='list'
          className='space-y-4 md:flex md:space-x-8'
        >
          {steps.map((step, index) => (
            <li key={step.name} className='md:flex-1'>
              {currentStep > index ? (
                <div className='group flex w-full flex-col border-l-4 border-sky-600 py-2 pl-4 transition-colors md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4'>
                  <span className='text-sm font-medium text-sky-600 transition-colors '>
                    {step.id}
                  </span>
                  <span className='text-sm font-medium'>{step.name}</span>
                </div>
              ) : currentStep === index ? (
                <div
                  className='flex w-full flex-col border-l-4 border-sky-600 py-2 pl-4 md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4'
                  aria-current='step'
                >
                  <span className='text-sm font-medium text-sky-600'>
                    {step.id}
                  </span>
                  <span className='text-sm font-medium'>{step.name}</span>
                </div>
              ) : (
                <div className='group flex w-full flex-col border-l-4 border-gray-200 py-2 pl-4 transition-colors md:border-l-0 md:border-t-4 md:pb-0 md:pl-0 md:pt-4'>
                  <span className='text-sm font-medium text-gray-500 transition-colors'>
                    {step.id}
                  </span>
                  <span className='text-sm font-medium'>{step.name}</span>
                </div>
              )}
            </li>
          ))}
        </ol>
      </nav>

      {/* Form */}
      <form className='mt-12 py-12' onSubmit={handleSubmit(processForm)}>
        {currentStep === 0 && (
          <div>
            <h2 className='text-xl font-semibold leading-7 text-gray-900'>
              1. Personal Employee Information
            </h2>

            <p className='mt-1 text-sm leading-6 text-gray-600'>
              Provide Employee's Personal Details
            </p>

            <hr className='max-w-3xl border-1 border-stone-200 mb-12 mt-2' />

            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='firstName' className='text-base font-semibold'>First Name</label>
                <input
                  type="text"
                  id="first-name"
                  className="form-input mt-4"
                  {...register('firstName', {
                    required: "*First name is required"
                  })}
                />
                {errors.firstName?.message && (
                  <p className='mt-1 text-sm text-red-500'>
                    {errors.firstName.message}
                  </p>
                )}
              </div>
            </div>
            
            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='lastName' className='text-base font-semibold'>Last Name</label>
                <input
                  type="text"
                  id="last-name"
                  className="form-input mt-4"
                  {...register('lastName', {
                    required: "*Last name is required"
                  })}
                />
                {errors.lastName?.message && (
                  <p className='mt-1 text-sm text-red-500'>
                    {errors.lastName.message}
                  </p>
                )}
              </div>
            </div>
            
            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='email' className='text-base font-semibold'>Email Address</label>
                <input
                  type="text"
                  id="email"
                  className="form-input mt-4"
                  {...register('email', {
                    required: "*Email address is required"
                  })}
                />
                {errors.email?.message && (
                  <p className='mt-1 text-sm text-red-500'>
                    {errors.email.message}
                  </p>
                )}
              </div>
            </div>
            
            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='phoneNumber' className='text-base font-semibold'>Phone Number</label>
                <input
                  type="text"
                  id="phoneNumber"
                  className="form-input mt-4"
                  {...register('phoneNumber', {
                    required: "*Phone number is required"
                  })}
                />
                {errors.phoneNumber?.message && (
                  <p className='mt-1 text-sm text-red-500'>
                    {errors.phoneNumber.message}
                  </p>
                )}
              </div>
            </div>

            <div className='mt-10'>
              <DatePickerCont
                name='dateOfBirth'
                label='Date of Birth'
                control={control}
              />
            </div>

            <div className='mt-10'>
              <label htmlFor="gender" className='text-base font-semibold'>Gender</label>
              <select
                id="gender"
                className="form-input form-select mt-4"
                {...register('gender', {
                  required: "*Gender is required",
                  validate: (value) => value !== '' || 'Select gender'
                })}
              >
                <option value="" disabled hidden>
                  Select gender
                </option>

                {genders.map((gender) => {
                  return (
                    <option key={gender} value={gender.toLowerCase()}>
                      {gender}
                    </option>
                    )
                })}
              </select>
              {errors.gender?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.gender.message}
                </p>
              )}
            </div>

            <div className='mt-10 grid grid-cols-1 gap-x-6'>
              <div className='mt-10 flex flex-col gap-5'>
                <h3 className='text-base font-semibold'>
                  Residential Address
                </h3>

                <div>
                  <input
                    type="text"
                    id="address-line-1"
                    className="form-input"
                    placeholder='Address Street Line 1'
                    {...register('addressLine1', {
                      required: "*Address is required"
                    })}
                  />
                  {errors.addressLine1?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.addressLine1.message}
                    </p>
                  )}
                </div>

                <div>
                  <input
                    type="text"
                    id="address-line-2"
                    className="form-input"
                    placeholder='Address Street Line 2'
                    {...register('addressLine2')}
                  />
                </div>
                
                <div>
                  <input
                    type="text"
                    id="city"
                    className="form-input"
                    placeholder='City/Town'
                    {...register('city', {
                      required: "*City/town is required"
                    })}
                  />
                  {errors.city?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.city.message}
                    </p>
                  )}
                </div>
                
                <div>
                  <input
                    type="text"
                    id="post-code"
                    className="form-input"
                    placeholder='Post Code'
                    {...register('postCode', {
                      required: "*Post Code is required"
                    })}
                  />
                  {errors.postCode?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.postCode.message}
                    </p>
                  )}
                </div>
                
                <div>
                  <label htmlFor="country" className='text-base font-semibold'>Country</label>
                  <select
                    id="country"
                    className="form-input form-select mt-4"
                    {...register('country', {
                      required: "*Country of residence is required",
                      validate: (value) => value !== '' || 'Select a country'
                    })}
                  >
                    <option value="" disabled hidden>
                      Select a country
                    </option>

                    {countries.map((country) => {
                      return (
                        <option key={country} value={country.toLowerCase().replace(' ', '-')}>
                          {country}
                        </option>
                        )
                    })}
                  </select>
                  {errors.country?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.country.message}
                    </p>
                  )}
                </div>
              </div>
            </div>

            <div className='mt-10 grid grid-cols-1 gap-x-6'>
              <div className='mt-10 flex flex-col gap-5'>
                <h3 className='text-base font-semibold'>
                  Emergency Contact Information
                </h3>

                <div>
                  <input
                    type="text"
                    id="emergency-contact-name"
                    className="form-input"
                    placeholder='Emergency Contact Name'
                    {...register('emergencyContactName', {
                      required: "*Emergency contact name is required"
                    })}
                  />
                  {errors.emergencyContactName?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.emergencyContactName.message}
                    </p>
                  )}
                </div>
                
                <div>
                  <input
                    type="text"
                    id="emergency-contact-phone"
                    className="form-input"
                    placeholder='Emergency Contact Phone'
                    {...register('emergencyContactPhone', {
                      required: "*Emergency contact phone number is required"
                    })}
                  />
                  {errors.emergencyContactPhone?.message && (
                    <p className='mt-1 text-sm text-red-500'>
                      {errors.emergencyContactPhone.message}
                    </p>
                  )}
                </div>
              </div>
            </div>
          </div>
        )}
        {currentStep === 1 && (
          <div>
            <h2 className='text-base font-semibold leading-7 text-gray-900'>
              Employee VISA Information
            </h2>

            <p className='mt-1 text-sm leading-6 text-gray-600'>
              Provide Employee VISA / Work Permit Details
            </p>

            <hr className='max-w-3xl border-1 border-stone-200 mb-12 mt-2' />

            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='employeeFirstName'>Passport Number</label>
                <input
                  type="text"
                  id="passport-number"
                  className="form-input"
                  {...register('passportNumber', {
                    required: "*Passport number is required"
                  })}
                />
                {errors.passportNumber?.message && (
                  <p className='mt-2 text-sm text-red-500'>
                    {errors.passportNumber.message}
                  </p>
                )}
              </div>
            </div>
            
            <div className='mt-10'>
              <DatePickerCont
                name='passportIssueDate'
                label='Passport Issue Date'
                control={control}
              />
            </div>
            
            <div className='mt-10'>
              <DatePickerCont
                name='passportExpiryDate'
                label='Passport Expiry Date'
                control={control}
              />
            </div>
            
            <div className='mt-10'>
              <DatePickerCont
                name='visaIssueDate'
                label='VISA Issue Date'
                control={control}
              />
            </div>
            
            <div className='mt-10'>
              <DatePickerCont
                name='visaExpiryDate'
                label='VISA Expiry Date'
                control={control}
              />
            </div>

            <div className='mt-10'>
              <label htmlFor="visaCategory" className='text-base font-semibold'>VISA Category</label>
              <select
                id="visaCategory"
                className="form-input form-select mt-4"
                {...register('visaCategory', {
                  required: "*VISA category is required",
                  validate: (value) => value !== '' || 'Select category'
                })}
              >
                <option value="" disabled hidden>
                  Select VISA category
                </option>

                {visaCategories.map((category) => {
                  return (
                    <option key={category} value={category.toLowerCase()}>
                      {category}
                    </option>
                    )
                })}
              </select>
              {errors.visaCategory?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.visaCategory.message}
                </p>
              )}
            </div>
            
            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='dbsCertificateNumber'>DBS Certificate Number</label>
                <input
                  type="text"
                  id="dbs-certificate-number"
                  className="form-input"
                  {...register('dbsCertificateNumber', {
                    required: "*DBS certificate number is required"
                  })}
                />
                {errors.dbsCertificateNumber?.message && (
                  <p className='mt-2 text-sm text-red-500'>
                    {errors.dbsCertificateNumber.message}
                  </p>
                )}
              </div>
            </div>
          </div>
        )}
        {currentStep === 2 && (
          <div>
            <h2 className='text-xl font-semibold leading-7 text-gray-900'>
              3. Employment Information
            </h2>

            <p className='mt-1 text-sm leading-6 text-gray-600'>
              Provide employee contract and other employment details
            </p>

            <hr className='max-w-3xl border-1 border-stone-200 mb-12 mt-2' />

            <div className='mt-10'>
              <label htmlFor="jobTitle" className='text-base font-semibold'>Job Title</label>
              <select
                id="job-title"
                className="form-input form-select mt-4"
                {...register('jobTitle', {
                  required: "*Job title is required",
                  validate: (value) => value !== '' || 'Select job title'
                })}
              >
                <option value="" disabled hidden>
                  Select job title
                </option>

                {jobTitles.map((title) => {
                  return (
                    <option key={title} value={title.toLowerCase()}>
                      {title}
                    </option>
                  )
                })}
              </select>
              {errors.jobTitle?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.jobTitle.message}
                </p>
              )}
            </div>
            
            <div className='mt-10'>
              <label htmlFor="department" className='text-base font-semibold'>Department</label>
              <select
                id="department"
                className="form-input form-select mt-4"
                {...register('department', {
                  required: "*Department is required",
                  validate: (value) => value !== '' || 'Select department'
                })}
              >
                <option value='' disabled hidden>
                  Select department
                </option>

                {departments.map((title) => {
                  return (
                    <option key={title} value={title.toLowerCase()}>
                      {title}
                    </option>
                    )
                })}
              </select>
              {errors.department?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.department.message}
                </p>
              )}
            </div>
            
            <div className='mt-10'>
              <label htmlFor="employmentStatus" className='text-base font-semibold'>Employment Status</label>
              <select
                id="employment-status"
                className="form-input form-select mt-4"
                {...register('employmentStatus', {
                  required: "*Employment status is required",
                  validate: (value) => value !== '' || 'Select employment status'
                })}
              >
                <option value='' disabled hidden>
                  Select employment status
                </option>

                {employmentStatuses.map((status) => {
                  return (
                    <option key={status} value={status.toLowerCase()}>
                      {status}
                    </option>
                    )
                })}
              </select>
              {errors.employmentStatus?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.employmentStatus.message}
                </p>
              )}
            </div>

            <div className='mt-10'>
              <DatePickerCont
                name='employmentStartDate'
                label='Employment Start Date'
                control={control}
              />
            </div>

            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='salary'>Salary</label>
                <input
                  type="text"
                  id="salary"
                  className="form-input"
                  {...register('salary', {
                    required: "*Salary is required"
                  })}
                />
                {errors.salary?.message && (
                  <p className='mt-2 text-sm text-red-500'>
                    {errors.salary.message}
                  </p>
                )}
              </div>
            </div>

            <div className='mt-10'>
              <label htmlFor="payFrequency" className='text-base font-semibold'>Pay Frequency</label>
              <select
                id="pay-frequency"
                className="form-input form-select mt-4"
                {...register('payFrequency', {
                  required: "*Pay frequency is required",
                  validate: (value) => value !== '' || 'Select pay frequency'
                })}
              >
                <option value='' disabled hidden>
                  Select pay frequency
                </option>

                {payFrequency.map((title) => {
                  return (
                    <option key={title} value={title.toLowerCase()}>
                      {title}
                    </option>
                    )
                })}
              </select>
              {errors.payFrequency?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.payFrequency.message}
                </p>
              )}
            </div>
            
            <div className='mt-10'>
              <label htmlFor="paymentMethod" className='text-base font-semibold'>Pay Method</label>
              <select
                id="payment-method"
                className="form-input form-select mt-4"
                {...register('paymentMethod', {
                  required: "*Pay frequency is required",
                  validate: (value) => value !== '' || 'Select payment method'
                })}
              >
                <option value='' disabled hidden>
                  Select payment method
                </option>

                {paymentMethods.map((title) => {
                  return (
                    <option key={title} value={title.toLowerCase()}>
                      {title}
                    </option>
                    )
                })}
              </select>
              {errors.paymentMethod?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.paymentMethod.message}
                </p>
              )}
            </div>

            <div className='mt-10 grid grid-cols-1 gap-x-6'>
              <div>
                <label htmlFor='weeklyHours'>Hours of Work Per Week</label>
                <input
                  type="text"
                  id="weekly-hours"
                  className="form-input"
                  {...register('weeklyHours', {
                    required: "*Hours to be worked per week is required"
                  })}
                />
                {errors.weeklyHours?.message && (
                  <p className='mt-2 text-sm text-red-500'>
                    {errors.weeklyHours.message}
                  </p>
                )}
              </div>
            </div>

            <div className='mt-10'>
              <label htmlFor="taxCode" className='text-base font-semibold'>Tax Code</label>
              <select
                id="tax-code"
                className="form-input form-select mt-4"
                {...register('taxCode', {
                  required: "*Tax code is required",
                  validate: (value) => value !== '' || 'Select tax code'
                })}
              >
                <option value='' disabled hidden>
                  Select tax code
                </option>

                {taxCodes.map((code) => {
                  return (
                    <option key={code} value={code.toLowerCase()}>
                      {code}
                    </option>
                    )
                })}
              </select>
              {errors.taxCode?.message && (
                <p className='mt-1 text-sm text-red-500'>
                  {errors.taxCode.message}
                </p>
              )}
            </div>

            <div className='mt-10 grid grid-cols-1 gap-x-6 '>
              <div>
                <label htmlFor='lineManagerName'>Line Manager Name</label>
                <input
                  type="text"
                  id="line-manager-name"
                  className="form-input"
                  {...register('lineManagerName', {
                    required: "*Name of line manager is required"
                  })}
                />
                {errors.lineManagerName?.message && (
                  <p className='mt-2 text-sm text-red-500'>
                    {errors.lineManagerName.message}
                  </p>
                )}
              </div>
            </div>

            <button
              className='py-3 px-16 mt-10 rounded bg-sky-600 text-white hover:cursor-pointer hover:bg-sky-400 transition-all duration-300'
            >
              Submit
            </button>
          </div>
        )}
        {currentStep === 3 && (
          <div>New Employee Successfully Created</div>
        )}
      </form>

      {/* Navigation Buttons */}
      <div className='block my-5pt-5'>
        <div className='flex justify-between'>
          <button
            type='button'
            onClick={prev}
            disabled={currentStep === 0}
            className='rounded bg-white px-2 py-1 text-sm font-semibold text-sky-900 shadow-sm ring-1 ring-inset ring-sky-300 hover:bg-sky-50 disabled:cursor-not-allowed disabled:opacity-50'
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              fill='none'
              viewBox='0 0 24 24'
              strokeWidth='1.5'
              stroke='currentColor'
              className='h-6 w-6'
            >
              <path
                strokeLinecap='round'
                strokeLinejoin='round'
                d='M15.75 19.5L8.25 12l7.5-7.5'
              />
            </svg>
          </button>
          
          <button
            type='button'
            onClick={next}
            disabled={currentStep === steps.length - 1}
            className='rounded bg-white px-2 py-1 text-sm font-semibold text-sky-900 shadow-sm ring-1 ring-inset ring-sky-300 hover:bg-sky-50 disabled:cursor-not-allowed disabled:opacity-50'
          >
            <svg
              xmlns='http://www.w3.org/2000/svg'
              fill='none'
              viewBox='0 0 24 24'
              strokeWidth='1.5'
              stroke='currentColor'
              className='h-6 w-6'
            >
              <path
                strokeLinecap='round'
                strokeLinejoin='round'
                d='M8.25 4.5l7.5 7.5-7.5 7.5'
              />
            </svg>
          </button>
        </div>
      </div>
    </section>
  )
}

export default EmployeeOnboardingForm